{"version":3,"file":"navigation.js","sourceRoot":"","sources":["navigation.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,yDAAmD;AAQnD,4CAKsB;AAEtB;;GAEG;AACH,MAAa,UAAU;IAQrB;QANA,YAAO,GAA+B,EAAgC,CAAA;QAEtE,YAAO,GAAuD,IAAI,kCAAe,EAAoC,CAAA;QAErH,uCAAqC;QAInC,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,EAAE,CAAC;IAE5D,CAAC;IAED,gBAAgB;QAEd,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,IAAE,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC,CAAiB,CAAA;IAE7H,CAAC;IAED,YAAY;QAEV,OAAO,uBAAA,IAAI,4BAAU,CAAC;IAExB,CAAC;IAED,YAAY;QAEV,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAC,CAAC;YAEjC,OAAO,IAAA,2BAAe,EAAK,CAAC,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAE,CAAC;QAE5F,CAAC;aAEG,CAAC;YAEH,OAAO,IAAA,2BAAe,EAAK,QAAQ,CAAC,MAAM,CAAE,CAAC;QAE/C,CAAC;IAGH,CAAC;IAED,SAAS,CAAC,UAA4C,EAAE,KAAsE;QAE5H,IAAI,CAAC,OAAO,CAAE,UAAU,CAAE,GAAG,KAAK,CAAC;QAEnC,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,UAAU,CAAE,OAAmC;QAE7C,IAAI,CAAC,OAAO,GAAG,IAAA,wBAAY,EAA8B,IAAI,CAAC,OAAO,EAAE,OAAO,CAAE,CAAA;QAEhF,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,IAAI,CAAE,CAAA;QAEvC,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,UAAU,CAAE,UAAkD;;QAE5D,MAAA,IAAI,CAAC,OAAO,CAAC,WAAW,0CAAE,IAAI,CAAE,UAAU,CAAE,CAAA;QAE5C,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,OAAO;QAEL,MAAM,CAAC,gBAAgB,CAAE,UAAU,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAE,EAAE,CAAE,CAAE,CAAA;QAExE,IAAI,CAAC,eAAe,EAAE,CAAA;QAEtB,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,eAAe;QAEb,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YAEzB,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE,EAAE;gBAE7C,MAAM,MAAM,GAAG,IAAI,CAAC,oBAAoB,CAAE,EAAE,CAAE,CAAA;gBAG9C,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,uBAAuB,CAAC,EAAE,CAAC;oBAE5D,MAAM,GAAG,GAAG,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,MAAM,CAAC,YAAY,CAAC,eAAe,CAAC,IAAI,MAAM,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC;oBAExH,MAAM,KAAK,GAAG,CAAC,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,WAAW,EAAE,IAAI,QAAQ,CAAC;oBAE9E,MAAM,QAAQ,GAAG,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAE,GAAG,CAAE,CAAC,CAAC,CAAC,KAAK,CAAC;oBAGzD,IAAI,GAAG,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,EAAE,CAAC;wBAE/B,EAAE,CAAC,cAAc,EAAE,CAAC;wBAEpB,IAAI,CAAC,QAAQ,CAAE,IAAI,CAAC,cAAc,CAAE,GAAG,CAAkB,EAAE,EAA0B,EAAE,EAAE,CAAE,CAAA;oBAE7F,CAAC;gBAGH,CAAC;YAEH,CAAC,EAAE,KAAK,CAAE,CAAA;QAEZ,CAAC;QAED,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,cAAc,CAAE,SAAkB;QAEhC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,EAAE,CAAC;QAE/B,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAExC,OAAO,CAAE,SAAS,IAAI,GAAG,IAAI,SAAS,IAAI,GAAG,CAAE,CAAC,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;IAE/E,CAAC;IAED,aAAa,CAAE,GAAY;QAEzB,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;IAE1D,CAAC;IAED,oBAAoB,CAAE,EAAU;QAE9B,IAAI,EAAE,CAAC,MAAM,YAAY,WAAW,EAAE,CAAC;YAErC,IAAI,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC,MAAM,CAAC,OAAO,IAAI,GAAG,EAAE,CAAC;gBAExE,OAAO,EAAE,CAAC,MAAM,CAAC;YAEnB,CAAC;iBAEG,CAAC;gBAEH,OAAO,IAAA,4BAAgB,EAAe,EAAE,CAAC,MAAqB,EAAE,MAAM,CAAC,EAAE,CAEvE,MAAM,CAAC,OAAO,IAAI,GAAG,IAAI,MAAM,CAAC,YAAY,CAAC,eAAe,CAAC,CAE9D,CAAA;YAEH,CAAC;QAEH,CAAC;QAED,OAAO,SAAS,CAAA;IAElB,CAAC;IAED,gBAAgB,CAAE,EAAuB;;QAEvC,MAAM,SAAS,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAE1C,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC;QAGvE,MAAA,IAAI,CAAC,OAAO,CAAC,WAAW,0CAAE,OAAO,CAAE,UAAU,CAAC,EAAE,CAAC,UAAU,CAAE;YAE3D,UAAU,EAAE,IAAI;YAEhB,KAAK,EAAE,EAAE;YAET,SAAS,EAAE,IAAI,CAAC,gBAAgB,EAAE;YAElC,KAAK,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,SAAS;YAEvC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW;SAEhE,CAAE,CAAE,CAAA;QAEL,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,EAAE;YAEhC,UAAU,EAAG,IAAI;YAEjB,SAAS;YAET,MAAM,EAAE,MAAM;SAEf,CAAC,CAAA;QAEF,uBAAA,IAAI,wBAAa,SAAyB,MAAA,CAAC;QAE3C,OAAO,IAAI,CAAC;IAEd,CAAC;IAED,QAAQ,CAAE,KAAoB,EAAE,KAAiC,EAAE,EAAU;QAE3E,IAAI,CAAC,KAAK,EAAE,CAAC;YAAC,OAAO,IAAI,CAAC;QAAC,CAAC;QAE5B,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAE7C,MAAM,SAAS,GAAG,KAAe,CAAC;QAElC,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAE,KAAK,IAAI,EAAE,CAAE,CAAC,MAAM,CAAC;QAEnD,MAAM,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAK,IAAA,2BAAe,EAAE,KAAK,IAAE,EAAE,CAAG,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QAGnE,IAAI,YAAY,IAAI,SAAS,EAAE,CAAC;YAE9B,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC;gBAElC,QAAQ,CAAC,IAAI,GAAG,GAAI,SAAU,GAAI,KAAM,EAAE,CAAC;YAE7C,CAAC;iBAEG,CAAC;gBAEH,OAAO,CAAC,SAAS,CAAE,KAAK,IAAI,EAAE,EAAE,QAAQ,CAAC,KAAK,EAAE,GAAI,SAAU,GAAI,KAAM,EAAE,CAAC,CAAC;gBAE5E,IAAI,CAAC,gBAAgB,CAAE,EAAE,IAAI,SAAS,CAAE,CAAC;YAE3C,CAAC;QAEH,CAAC;aAEG,CAAC;YAAC,IAAI,CAAC,gBAAgB,CAAE,EAAE,IAAI,SAAS,CAAE,CAAC;QAAC,CAAC;QAEjD,OAAO,IAAI,CAAC;IAEd,CAAC;CAEF;AAxOD,gCAwOC","sourcesContent":["import {EventDispatcher} from \"./event-dispatcher\";\nimport type { \n  IEventDispatcher, \n  INavigation, \n  INavigationEmitterScheme, \n  INavigationMiddlewareCallback, \n  INavigationOptions \n} from \"../types\";\nimport {\n  AscendingDOMPath,\n  ObjectURLParams,\n  URLParamsObject,\n  UpdateObject\n} from \"../utilities\";\n\n/**\n * Syst√®me de navigation\n */\nexport class Navigation<Scheme> implements INavigation<Scheme>{\n\n  options: INavigationOptions<Scheme> = {} as INavigationOptions<Scheme> \n\n  emitter: IEventDispatcher<INavigationEmitterScheme<Scheme>> = new EventDispatcher<INavigationEmitterScheme<Scheme>>()\n  \n  #oldRoute : keyof Scheme | undefined;\n  \n  constructor(){\n\n    this.options.middlewares = this.options.middlewares || [];\n    \n  }\n\n  currentRouteName() : keyof Scheme{\n\n    return (this.options.useHashtagParser ? (location.hash||'').split('?')[0] : location.pathname).substring(1) as keyof Scheme\n\n  }\n\n  oldRouteName() : keyof Scheme | undefined {\n\n    return this.#oldRoute;\n\n  }\n\n  currentQuery<T>() : T | undefined{\n\n    if( this.options.useHashtagParser){\n\n      return URLParamsObject<T>( (location.hash || location.search || '').split('?')[1] || '' );\n\n    }\n\n    else{\n\n      return URLParamsObject<T>( location.search );\n      \n    }\n\n    \n  }\n\n  setOption(optionName: keyof INavigationOptions<Scheme>, value: (INavigationMiddlewareCallback<Scheme>[] & boolean) | undefined ): this {\n      \n    this.options[ optionName ] = value;\n    \n    return this;\n    \n  }\n  \n  setOptions( options: INavigationOptions<Scheme> ): this {\n\n    this.options = UpdateObject<INavigationOptions<Scheme>>( this.options, options )\n      \n    this.emitter.dispatch('options', this )\n    \n    return this;\n    \n  }\n\n  middleware( middleware : INavigationMiddlewareCallback<Scheme> ): this {\n\n    this.options.middlewares?.push( middleware )\n      \n    return this;\n    \n  }\n  \n  observe(): this {\n\n    window.addEventListener( 'popstate' ,ev => this.dispatchNavigate( ev ) )\n\n    this.capturesActions()\n    \n    return this;\n    \n  }\n\n  capturesActions( ) : this {\n\n    if( this.options.capture ){\n\n      document.body.addEventListener('click', (ev) => {\n\n        const target = this.parseElementCaptured( ev )\n        \n\n        if( target && !target.hasAttribute('navigate:no-detection') ){\n          \n          const url = target.getAttribute('href') || target.getAttribute('navigate:view') || target.getAttribute('navigate-view');\n          \n          const blank = (target.getAttribute('target') || '').toLowerCase() == '_blank';\n\n          const external = url ? this.isExternalURL( url ) : false;\n          \n\n          if( url && !blank && !external ){\n\n            ev.preventDefault();\n\n            this.navigate( this.parseRouteName( url ) as keyof Scheme, {} as Scheme[keyof Scheme], ev )\n\n          }\n          \n          \n        }\n        \n      }, false )\n\n    }\n\n    return this;\n    \n  }\n\n  parseRouteName( routeName : string ){\n\n    const route = routeName.trim();\n\n    const firstChar = route.substring(0, 1);\n\n    return ( firstChar == '/' || firstChar == '#' ) ? route.substring(1) : route;\n    \n  }\n  \n  isExternalURL( url : string ){\n\n    return !!(url.match(/^http/gi) || url.match(/^\\/\\//gi));\n    \n  }\n  \n  parseElementCaptured( ev : Event ){\n\n    if( ev.target instanceof HTMLElement ){\n\n      if( ev.target.hasAttribute('navigate:view') || ev.target.tagName == \"A\" ){\n\n        return ev.target;\n        \n      }\n\n      else{\n\n        return AscendingDOMPath<HTMLElement>( ev.target as HTMLElement, parent => \n\n          parent.tagName == 'A' || parent.hasAttribute('navigate:view')\n          \n        )\n\n      }\n\n    }\n\n    return undefined\n    \n  }\n  \n  dispatchNavigate( ev ?: Event | undefined ) : this {\n\n    const routeName = this.currentRouteName();\n\n    const parser = this.options.useHashtagParser ? 'hashtag' : 'directory';\n\n    \n    this.options.middlewares?.forEach( middleware => middleware( {\n\n      navigation: this,\n\n      event: ev,\n\n      routeName: this.currentRouteName(),\n\n      props: this.currentQuery() || undefined,\n\n      parser: this.options.useHashtagParser ? 'hashtag' : 'directory',\n      \n    } ) )\n  \n    this.emitter.dispatch('navigate', { \n      \n      navigation : this, \n      \n      routeName, \n\n      parser: parser,\n    \n    })\n\n    this.#oldRoute = routeName as keyof Scheme;\n    \n    return this;\n    \n  }\n  \n  navigate( route : keyof Scheme, props ?: (Scheme[ keyof Scheme ]), ev?: Event ): this {\n\n    if( !route ){ return this; }\n    \n    const currentRoute = this.currentRouteName();\n    \n    const routeName = route as string;\n\n    const hasProps = Object.keys( props || {} ).length;\n\n    const query = hasProps ? `?${ ObjectURLParams( props||{} ) }` : '';\n\n    \n    if( currentRoute != routeName ){\n\n      if( this.options.useHashtagParser ){\n\n        location.hash = `${ routeName }${ query }`;\n        \n      }\n\n      else{\n\n        history.pushState( props || {}, document.title, `${ routeName }${ query }`);\n\n        this.dispatchNavigate( ev || undefined );\n        \n      }\n\n    }\n\n    else{ this.dispatchNavigate( ev || undefined ); }\n\n    return this;\n    \n  }\n  \n}\n"]}